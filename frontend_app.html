<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Receptari Culinari Digital (Frontend)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        /* Estils generals */
        body { font-family: 'Inter', sans-serif; background-color: #f8f8f8; }
        .btn-hover:hover { transform: translateY(-1px); box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06); }
        .recipe-card-hover:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1); }
        .search-bar-input:focus { border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.5); }
        /* Estils del Chatbot */
        .chat-message { max-width: 80%; padding: 10px; border-radius: 1rem; margin-bottom: 10px; }
        .user-message { background-color: #3b82f6; color: white; margin-left: auto; border-bottom-right-radius: 0; }
        .bot-message { background-color: #e5e7eb; color: #1f2937; margin-right: auto; border-bottom-left-radius: 0; }
        .hidden { display: none !important; }
        .animate-pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
    </style>
</head>
<body class="min-h-screen p-4 md:p-8">

    <header class="text-center mb-10">
        <h1 class="text-5xl font-extrabold text-gray-900 mb-2">
            Receptari Culinari Digital
        </h1>
        <p class="text-xl text-gray-500">
            La teva col·lecció de plats amb suport d'IA.
        </p>
    </header>
   
    <div id="connection-status"></div>
   
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
       
        <div class="lg:col-span-2">
           
            <div class="flex flex-col sm:flex-row justify-between items-center mb-6 gap-3">
                <div class="relative w-full sm:w-80">
                    <input
                        type="text"
                        id="search-input"
                        placeholder="Cerca per nom..."
                        class="search-bar-input w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:outline-none"
                    />
                    <i data-lucide="search" class="w-5 h-5 text-gray-400 absolute left-3 top-1/2 transform -translate-y-1/2"></i>
                </div>

                <div class="flex gap-2 w-full sm:w-auto">
                    <button id="view-list-btn" class="btn-hover px-4 py-3 rounded-xl font-semibold transition duration-150 w-full sm:w-auto bg-indigo-600 text-white shadow-md">
                        <i data-lucide="list-ordered" class="w-5 h-5 inline-block mr-1"></i>
                        Llista
                    </button>
                    <button id="view-add-btn" class="btn-hover px-4 py-3 rounded-xl font-semibold transition duration-150 w-full sm:w-auto bg-gray-200 text-gray-700 hover:bg-gray-300">
                        <i data-lucide="plus-circle" class="w-5 h-5 inline-block mr-1"></i>
                        Afegir
                    </button>
                </div>
            </div>
           
            <div id="filter-buttons" class="flex flex-wrap gap-2 mb-6">
                            </div>

            <div id="recipe-list-view">
                <div id="recipes-container" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    </div>
                <div id="no-recipes-message" class="hidden bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded-lg text-yellow-700">
                    <p class="font-bold">No s'han trobat receptes.</p>
                    <p>Prova d'ajustar la teva cerca o filtre.</p>
                </div>
                <div id="loading-message" class="hidden text-center py-10 text-gray-500 text-xl flex justify-center items-center">
                    <i data-lucide="loader" class="w-8 h-8 animate-spin mr-3"></i>
                    Carregant receptes...
                </div>
            </div>
           
            <div id="add-recipe-view" class="hidden bg-white p-6 rounded-xl shadow-lg border border-gray-100">
                <h2 class="text-3xl font-extrabold text-gray-900 mb-6">Afegir Nova Recepta</h2>
                <form id="add-recipe-form">
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="nom">Nom de la Recepta</label>
                        <input id="nom" name="nombre" type="text" required class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-indigo-500 rounded-lg"/>
                    </div>
                   
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="categoria">Categoria</label>
                        <select id="categoria" name="categoria" required class="shadow border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-indigo-500 rounded-lg">
                                                        <option value="aperitius_tapes">Aperitius i tapes</option>
                            <option value="begudes">Begudes</option>
                            <option value="carns_aus">Carns i aus</option>
                            <option value="amanides">Amanides</option>
                            <option value="guarnicions">Guarnicions</option>
                            <option value="ous">Ous</option>
                            <option value="llegums">Llegums</option>
                            <option value="peix_marisc">Peix i marisc</option>
                            <option value="postres">Postres</option>
                            <option value="salses_cremes">Salses i cremes</option>
                            <option value="sopes_cremes">Sopes i cremes</option>
                            <option value="verdures">Verdures</option>
                            <option value="internacionals">Internacionals</option>
                            <option value="festes">Per a Festes</option>
                            <option value="nens">Per a nens</option>
                        </select>
                    </div>
                   
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="ingredients">Ingredients (separats per línia o punt)</label>
                        <textarea id="ingredients" name="ingredientes" required rows="3" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-indigo-500 rounded-lg"></textarea>
                    </div>

                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="passos">Passos (Instruccions de preparació)</label>
                        <textarea id="passos" name="pasos" required rows="3" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-indigo-500 rounded-lg"></textarea>
                    </div>

                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="imatge_url">URL Imatge (Opcional)</label>
                        <input id="imatge_url" name="imagen_url" type="text" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-indigo-500 rounded-lg"/>
                    </div>

                    <button type="submit" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-xl focus:outline-none focus:shadow-outline transition duration-150 btn-hover flex items-center justify-center text-lg mt-4">
                        <i data-lucide="save" class="w-5 h-5 mr-2"></i>
                        Guardar Recepta
                    </button>
                </form>
            </div>

            <div id="floating-message-container" class="fixed top-5 left-1/2 transform -translate-x-1/2 z-50"></div>

        </div>

        <div class="lg:col-span-1 h-[80vh] lg:h-auto">
            <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-100 h-full flex flex-col">
                <h2 class="text-3xl font-extrabold text-gray-900 mb-4 flex items-center">
                    <i data-lucide="bot" class="w-7 h-7 mr-2 text-indigo-600"></i>
                    ChefBot Culinari
                </h2>
               
                <div id="chat-messages-container" class="flex-grow overflow-y-auto pr-2 mb-4 flex flex-col space-y-2">
                                    </div>
               
                <form id="chatbot-form" class="flex gap-2">
                    <input
                        type="text"
                        id="chatbot-input"
                        placeholder="Pregunta al ChefBot (p. ex: recepta de Crema Catalana)"
                        class="flex-grow shadow border rounded-xl py-3 px-4 text-gray-700 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                    />
                    <button
                        type="submit"
                        id="chatbot-send-btn"
                        class="btn-hover px-5 py-3 rounded-xl transition duration-150 flex items-center justify-center bg-indigo-600 hover:bg-indigo-700 text-white"
                    >
                        <i data-lucide="send" class="w-5 h-5"></i>
                    </button>
                </form>
                <p id="chatbot-status" class="text-sm mt-2 text-gray-500 hidden">ChefBot escrivint...</p>
            </div>
        </div>
    </div>

    <script>
        // === CONFIGURACIÓ: AQUEST ÉS EL PUNT CLAU PER A LA CONNEXIÓ ===
        // FIX 1: Canvi de l'URL absolut a relatiu per evitar problemes de xarxa en entorns iframes/pilots.
        const API_BASE_URL = '';
        let globalRecipes = [];
        let currentFilter = 'all';
        let searchTerm = '';
        let isConnected = false;
        let isChatbotLoading = false;
       
        // NOU: Categories de receptes actualitzades
        const CATEGORIES = {
            'all': { label: 'Totes les Receptes', color: 'bg-indigo-500' },
            'aperitius_tapes': { label: 'Aperitius i tapes', color: 'bg-red-500' },
            'begudes': { label: 'Begudes', color: 'bg-teal-500' },
            'carns_aus': { label: 'Carns i aus', color: 'bg-amber-700' },
            'amanides': { label: 'Amanides', color: 'bg-green-500' },
            'guarnicions': { label: 'Guarnicions', color: 'bg-lime-500' },
            'ous': { label: 'Ous', color: 'bg-yellow-500' },
            'llegums': { label: 'Llegums', color: 'bg-orange-500' },
            'peix_marisc': { label: 'Peix i marisc', color: 'bg-cyan-500' },
            'postres': { label: 'Postres', color: 'bg-pink-500' },
            'salses_cremes': { label: 'Salses i cremes', color: 'bg-purple-500' },
            'sopes_cremes': { label: 'Sopes i cremes', color: 'bg-blue-500' },
            'verdures': { label: 'Verdures', color: 'bg-emerald-500' },
            'internacionals': { label: 'Internacionals', color: 'bg-gray-500' },
            'festes': { label: 'Per a Festes', color: 'bg-rose-500' },
            'nens': { label: 'Per a nens', color: 'bg-fuchsia-500' },
        };

        const MOCK_RECIPES = [
            { id: 'm1', nombre: "Sopa de Tomàquet Clàssica (MOCK)", categoria: "sopes_cremes", ingredientes: "Tomàquets frescos, Alfàbrega, Brou de verdures, Nata.", passos: "1. Sofregiu la ceba. 2. Afegiu els tomàquets i el brou. 3. Deixeu bullir i liquar. 4. Serviu amb una mica de nata.", imagen_url: "https://placehold.co/400x300/f87171/fff?text=MOCK+Sopa" },
        ];
       
        // === ELEMENTS DEL DOM (Selectors) ===
        const $recipesContainer = document.getElementById('recipes-container');
        const $connectionStatus = document.getElementById('connection-status');
        const $filterButtons = document.getElementById('filter-buttons');
        const $searchInput = document.getElementById('search-input');
        const $addRecipeForm = document.getElementById('add-recipe-form');
        const $listBtn = document.getElementById('view-list-btn');
        const $addBtn = document.getElementById('view-add-btn');
        const $recipeListView = document.getElementById('recipe-list-view');
        const $addRecipeView = document.getElementById('add-recipe-view');
        const $loadingMessage = document.getElementById('loading-message');
        const $noRecipesMessage = document.getElementById('no-recipes-message');
        const $chatContainer = document.getElementById('chat-messages-container');
        const $chatbotForm = document.getElementById('chatbot-form');
        const $chatbotInput = document.getElementById('chatbot-input');
        const $chatbotSendBtn = document.getElementById('chatbot-send-btn');
        const $chatbotStatus = document.getElementById('chatbot-status');


        // === FUNCIONS D'UTILITAT I RENDERING ===
       
        function renderConnectionStatus(error = null) {
            let html;
            const displayUrl = API_BASE_URL || 'l\'adreça local';
            if (isConnected) {
                html = `
                    <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-6" role="alert">
                        <strong class="font-bold">Connexió OK!</strong>
                        <span class="block sm:inline"> Connectat a ${displayUrl}</span>
                    </div>
                `;
            } else {
                html = `
                    <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-6" role="alert">
                        <strong class="font-bold">Error de Connexió!</strong>
                        <span class="block sm:inline"> **REVISAR BACKEND:** L'aplicació mostra dades de **prova (MOCK DATA)**. (${displayUrl} no respon).<br/>
                        ${error ? `<span class="text-sm italic">Detall: ${error}</span>` : ''}
                        </span>
                    </div>
                `;
            }
            $connectionStatus.innerHTML = html;
        }

        function showFloatingMessage(message, type = 'info', duration = 3000) {
            const container = document.getElementById('floating-message-container');
            const colorClasses = { success: 'bg-green-500', error: 'bg-red-500', info: 'bg-blue-500' };

            const msgDiv = document.createElement('div');
            msgDiv.className = `p-4 rounded-lg shadow-xl text-white font-semibold transition-opacity duration-300 ${colorClasses[type]}`;
            msgDiv.style.opacity = '0';
            msgDiv.innerHTML = `${message}<button class="ml-4 text-white hover:text-gray-200" onclick="this.parentNode.remove()"><i data-lucide="x" class="w-4 h-4 inline-block"></i></button>`;
            container.appendChild(msgDiv);
            lucide.createIcons();
            setTimeout(() => { msgDiv.style.opacity = '1'; }, 10);
            setTimeout(() => { msgDiv.style.opacity = '0'; setTimeout(() => msgDiv.remove(), 300); }, duration);
        }

        function createRecipeCard(recipe) {
            const catInfo = CATEGORIES[recipe.categoria] || CATEGORIES['all'];
            // Assegura't que el color sigui vàlid o utilitza un valor per defecte
            const colorClass = catInfo.color || 'bg-gray-500';
            return `
                <div class="recipe-card-hover bg-white rounded-xl shadow-lg overflow-hidden transition duration-300 transform border border-gray-100">
                    <div class="h-48 overflow-hidden">
                        <img src="${recipe.imagen_url || 'https://placehold.co/400x300/e5e7eb/374151?text=Sense+Imatge'}"
                            alt="${recipe.nombre}" class="w-full h-full object-cover"
                            onerror="this.onerror=null; this.src='https://placehold.co/400x300/e5e7eb/374151?text=Sense+Imatge';" />
                    </div>
                    <div class="p-5">
                        <div class="flex justify-between items-center mb-3">
                            <span class="px-3 py-1 text-xs font-semibold rounded-full text-white ${colorClass}">
                                ${catInfo.label}
                            </span>
                        </div>
                        <h3 class="text-2xl font-bold text-gray-800 mb-2">${recipe.nombre}</h3>
                       
                        <button class="btn-hover text-sm font-medium text-indigo-600 hover:text-indigo-800 flex items-center mt-3 toggle-details-btn" data-recipe-id="${recipe.id}">
                            <i data-lucide="chevron-down" class="w-4 h-4 mr-1"></i>
                            Veure Detalls
                        </button>

                        <div id="details-${recipe.id}" class="hidden mt-4 pt-4 border-t border-gray-100">
                            <h4 class="text-lg font-semibold text-gray-700 mb-2">Ingredients:</h4>
                            <p class="text-gray-600 mb-4 whitespace-pre-line">${recipe.ingredientes}</p>
                           
                            <h4 class="text-lg font-semibold text-gray-700 mb-2">Passos:</h4>
                            <p class="text-gray-600 whitespace-pre-line">${recipe.pasos}</p>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderFilterButtons() {
            let html = '';
            for (const key in CATEGORIES) {
                const catInfo = CATEGORIES[key];
                const isActive = key === currentFilter ? 'bg-indigo-600 text-white shadow-md' : 'bg-gray-100 text-gray-700 hover:bg-gray-200';
                html += `<button data-filter="${key}" class="btn-hover px-4 py-2 rounded-full text-sm font-medium transition duration-150 filter-btn ${isActive}">${catInfo.label}</button>`;
            }
            $filterButtons.innerHTML = html;
        }

        function renderRecipes() {
            const filteredRecipes = globalRecipes.filter(recipe => {
                const matchesFilter = currentFilter === 'all' || recipe.categoria === currentFilter;
                const matchesSearch = searchTerm.trim() === '' || recipe.nombre.toLowerCase().includes(searchTerm.toLowerCase());
                return matchesFilter && matchesSearch;
            });

            $loadingMessage.classList.add('hidden');
            if (filteredRecipes.length === 0) {
                $noRecipesMessage.classList.remove('hidden');
                $recipesContainer.innerHTML = '';
            } else {
                $noRecipesMessage.classList.add('hidden');
                $recipesContainer.innerHTML = filteredRecipes.map(createRecipeCard).join('');
            }
            lucide.createIcons();
        }

        async function fetchRecipes(category = 'all') {
            $loadingMessage.classList.remove('hidden');
            $recipesContainer.innerHTML = '';
           
            let urlRecipe, urlStatus;
            urlStatus = `${API_BASE_URL}/status`;
            if (category === 'all') {
                urlRecipe = `${API_BASE_URL}/recipes/all`;
            } else {
                urlRecipe = `${API_BASE_URL}/recipes/category/${category}`;
            }

            try {
                // 1. Comprovar l'estat del servidor
                const statusResponse = await fetch(urlStatus);
                const statusData = await statusResponse.json();
               
                // FIX 2: La cadena de text ha de coincidir amb el que retorna app.py
                if (statusResponse.ok && statusData.status === "Servidor Flask Recetario CSV activo") {
                    isConnected = true;
                   
                    // 2. Obtenir les receptes
                    const response = await fetch(urlRecipe);
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    const data = await response.json();
                    globalRecipes = data;
                } else {
                    isConnected = false;
                    globalRecipes = MOCK_RECIPES;
                }
            } catch (error) {
                isConnected = false;
                globalRecipes = MOCK_RECIPES;
                renderConnectionStatus(error.message);
            } finally {
                $loadingMessage.classList.add('hidden');
                renderConnectionStatus();
                renderRecipes();
                renderFilterButtons();
            }
        }
       
        // --- GESTIÓ D'INTERACCIÓ ---

        function switchView(view) {
            if (view === 'list') {
                $recipeListView.classList.remove('hidden');
                $addRecipeView.classList.add('hidden');
                $listBtn.classList.add('bg-indigo-600', 'text-white', 'shadow-md');
                $listBtn.classList.remove('bg-gray-200', 'text-gray-700', 'hover:bg-gray-300');
                $addBtn.classList.remove('bg-indigo-600', 'text-white', 'shadow-md');
                $addBtn.classList.add('bg-gray-200', 'text-gray-700', 'hover:bg-gray-300');
            } else if (view === 'add') {
                $recipeListView.classList.add('hidden');
                $addRecipeView.classList.remove('hidden');
                $addBtn.classList.add('bg-indigo-600', 'text-white', 'shadow-md');
                $addBtn.classList.remove('bg-gray-200', 'text-gray-700', 'hover:bg-gray-300');
                $listBtn.classList.remove('bg-indigo-600', 'text-white', 'shadow-md');
                $listBtn.classList.add('bg-gray-200', 'text-gray-700', 'hover:bg-gray-300');
            }
            lucide.createIcons();
        }
       
        // --- GESTIÓ DEL CHATBOT ---
       
        function appendChatMessage(text, sender) {
            const msgDiv = document.createElement('div');
            // Reemplaça salts de línia del bot per <br> i formatació per negreta
            msgDiv.innerHTML = sender === 'bot' ? text.replace(/\n/g, '<br>').replace(/\*\*/g, '<b>') : text;
            msgDiv.className = `chat-message ${sender === 'user' ? 'user-message' : 'bot-message'}`;
            $chatContainer.appendChild(msgDiv);
            $chatContainer.scrollTop = $chatContainer.scrollHeight;
        }
       
        async function sendChatbotMessage(userMessage) {
            if (userMessage === '' || isChatbotLoading) return;

            appendChatMessage(userMessage, 'user');
            $chatbotInput.value = '';
           
            if (!isConnected) {
                appendChatMessage("ERROR: La connexió amb el servidor Flask és necessària per utilitzar ChefBot.", 'bot');
                return;
            }
           
            isChatbotLoading = true;
            $chatbotStatus.classList.remove('hidden');
            $chatbotStatus.classList.remove('text-red-500');
            $chatbotStatus.classList.add('animate-pulse', 'text-gray-500');
            $chatbotInput.disabled = true;
            $chatbotSendBtn.disabled = true;
           
            try {
                const response = await fetch(`${API_BASE_URL}/chatbot`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: userMessage }),
                });

                const result = await response.json();
               
                let botResponse = result.response || result.message || "No he pogut obtenir una resposta vàlida del servidor. (Error de format de JSON)";
                appendChatMessage(botResponse, 'bot');

            } catch (error) {
                console.error("Error al cridar /chatbot:", error);
                $chatbotStatus.textContent = "ERROR de xarxa. No s'ha pogut contactar amb el servidor.";
                $chatbotStatus.classList.add('text-red-500');
                appendChatMessage("ERROR de xarxa. No s'ha pogut contactar amb el servidor.", 'bot');
            } finally {
                isChatbotLoading = false;
                $chatbotStatus.classList.add('hidden');
                $chatbotStatus.classList.remove('animate-pulse');
                $chatbotInput.disabled = false;
                $chatbotSendBtn.disabled = false;
            }
        }


        // === GESTIÓ D'ESDEVENIMENTS (LISTENERS) ===

        $filterButtons.addEventListener('click', (e) => {
            if (e.target.classList.contains('filter-btn')) {
                const newFilter = e.target.getAttribute('data-filter');
                if (newFilter !== currentFilter) {
                    currentFilter = newFilter;
                    isConnected ? fetchRecipes(currentFilter) : renderRecipes();
                    renderFilterButtons();
                }
            }
        });
       
        $recipesContainer.addEventListener('click', (e) => {
            const btn = e.target.closest('.toggle-details-btn');
            if (btn) {
                const recipeId = btn.getAttribute('data-recipe-id');
                const details = document.getElementById(`details-${recipeId}`);
                const isHidden = details.classList.toggle('hidden');
               
                const icon = btn.querySelector('[data-lucide]');
                const textNode = Array.from(btn.childNodes).find(node => node.nodeType === 3 && node.nodeValue.trim() !== '');

                if (icon && textNode) {
                    if (isHidden) {
                        icon.setAttribute('data-lucide', 'chevron-down');
                        textNode.nodeValue = 'Veure Detalls';
                    } else {
                        icon.setAttribute('data-lucide', 'chevron-up');
                        textNode.nodeValue = 'Tancar Detalls';
                    }
                    lucide.createIcons();
                }
            }
        });

        $searchInput.addEventListener('input', (e) => {
            searchTerm = e.target.value;
            renderRecipes();
        });

        $listBtn.addEventListener('click', () => switchView('list'));
        $addBtn.addEventListener('click', () => switchView('add'));

        $addRecipeForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const newRecipe = Object.fromEntries(formData.entries());

            if (!isConnected) {
                globalRecipes.unshift({ ...newRecipe, id: 'm' + Date.now() });
                renderRecipes();
                showFloatingMessage("Recepta afegida al MOCK DATA (No es guardarà de forma persistent).", 'info');
                e.target.reset();
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/recipes/add`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(newRecipe),
                });
               
                const result = await response.json();
               
                if (response.ok && result.success) {
                    showFloatingMessage("Recepta afegida amb èxit!", 'success');
                    e.target.reset();
                    fetchRecipes(currentFilter);
                    switchView('list');
                } else {
                    showFloatingMessage(result.message || "Error desconegut en afegir la recepta.", 'error', 5000);
                }
            } catch (error) {
                console.error("Error en POST /recipes/add:", error);
                showFloatingMessage(`Error de xarxa en guardar: ${error.message}`, 'error', 5000);
            }
        });

        $chatbotForm.addEventListener('submit', (e) => {
            e.preventDefault();
            sendChatbotMessage($chatbotInput.value.trim());
        });
       
        // === INICIALITZACIÓ ===
        window.onload = function () {
            appendChatMessage('Hola! Sóc ChefBot, el teu assistent culinari. En què et puc ajudar avui? Prova a preguntar per una recepta (p. ex: Escalivada al Forn).', 'bot');
            fetchRecipes(currentFilter);
            lucide.createIcons();
        };

    </script>
</body>
</html>
